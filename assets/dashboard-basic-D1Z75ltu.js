import{Ct as e,Gt as t,It as n,Kt as r,Lt as i,Pt as a,St as o,Ut as s,Wt as c,an as l,on as u,un as d}from"./index-DmwTqtwr.js";import{n as f,r as p,t as m}from"./useAuth-36znuZB8.js";import{n as h,t as g}from"./devices.endpoint-CRqe-zDu.js";var _={class:`basic-dashboard`},v={key:0,class:`summary-cards`},y={key:0,class:`card`},b={class:`value`},x={key:1,class:`card`},S={class:`value`},C={key:2,class:`card`},w={class:`value`},T={key:1,class:`charts`},E={key:0,class:`chart`},D={key:1,class:`chart`},O={key:2,class:`empty-state`},k=o({__name:`dashboard-basic`,setup(o){let k=e(),{userId:A,getCurrentUser:j}=m();f.register(...p);let M=l(0),N=l(!1),P=l([]),F=l([]),I={consumo:null,costos:null},L=l(0),R=l(0);async function z(){let e=await g.getByUserId(A);if(N.value=e.length>0,!N.value){B();return}P.value=e.map(e=>parseFloat(e.metrics?.monthly??0)),F.value=e.map(e=>parseFloat(e.metrics?.estimatedCost??0));let t=e.map(e=>parseFloat(e.metrics?.tariff??0)).filter(e=>e>0);M.value=t.length?t.reduce((e,t)=>e+t)/t.length:0,L.value=P.value.reduce((e,t)=>e+t,0),R.value=F.value.reduce((e,t)=>e+t,0),await s(),V(e)}function B(){Object.values(I).forEach(e=>e?.destroy?.()),I.consumo=I.costos=null}function V(e){let t=document.getElementById(`chartConsumoMensual`),n=document.getElementById(`chartCostosMensuales`);if(!t||!n)return;B();let r=e.map(e=>e.name||`Dispositivo ${e.id}`);I.consumo=new f(t.getContext(`2d`),{type:`bar`,data:{labels:r,datasets:[{label:`Consumo (kWh)`,data:P.value,backgroundColor:`#0b2541`}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}}),I.costos=new f(n.getContext(`2d`),{type:`line`,data:{labels:r,datasets:[{label:`Costo (S/)`,data:F.value,borderColor:`#f46161`,backgroundColor:`rgba(244,97,97,0.2)`,fill:!0,tension:.3,pointBackgroundColor:`#f46161`,pointRadius:5}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})}let H;return t(async()=>{await j(),await z(),H=h(async()=>{console.log(`ðŸ“¡ Cambio en dispositivos â†’ recargando dashboard bÃ¡sico...`),await z()}),k.loadPersonalization()}),c(()=>{H?.(),B()}),(e,t)=>(r(),i(`div`,_,[t[9]||=a(`h1`,{class:`title`},`Panel de EnergÃ­a - Usuario BÃ¡sico`,-1),N.value?(r(),i(`div`,v,[u(k).kpiCurrent?(r(),i(`div`,y,[t[0]||=a(`span`,{class:`emoji`},`ðŸ’¡`,-1),t[1]||=a(`p`,{class:`label`},`Consumo Total`,-1),a(`p`,b,d(L.value)+` kWh`,1)])):n(``,!0),u(k).kpiCost?(r(),i(`div`,x,[t[2]||=a(`span`,{class:`emoji`},`ðŸ’°`,-1),t[3]||=a(`p`,{class:`label`},`Costo Estimado`,-1),a(`p`,S,`S/ `+d(R.value.toFixed(2)),1)])):n(``,!0),u(k).kpiTariff?(r(),i(`div`,C,[t[4]||=a(`span`,{class:`emoji`},`âš¡`,-1),t[5]||=a(`p`,{class:`label`},`Tarifa Promedio`,-1),a(`p`,w,`S/ `+d(M.value.toFixed(2))+`/kWh`,1)])):n(``,!0)])):n(``,!0),N.value?(r(),i(`div`,T,[u(k).chartDevice?(r(),i(`div`,E,[...t[6]||=[a(`h3`,null,`Consumo por Dispositivo (kWh)`,-1),a(`canvas`,{id:`chartConsumoMensual`},null,-1)]])):n(``,!0),u(k).chartCost?(r(),i(`div`,D,[...t[7]||=[a(`h3`,null,`Costos Estimados por Dispositivo (S/)`,-1),a(`canvas`,{id:`chartCostosMensuales`},null,-1)]])):n(``,!0)])):(r(),i(`div`,O,[...t[8]||=[a(`p`,null,`ðŸ”Œ No tienes dispositivos vinculados todavÃ­a.`,-1),a(`small`,null,`Agrega un dispositivo para visualizar tus mÃ©tricas.`,-1)]]))]))}},[[`__scopeId`,`data-v-10d599c7`]]);export{k as default};