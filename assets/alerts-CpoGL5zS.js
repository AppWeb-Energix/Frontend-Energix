import{Bt as e,Gt as t,It as n,Kt as r,Lt as i,Nt as a,Pt as o,St as s,an as c,bt as l,jt as u,qt as d,sn as f,un as p}from"./index-B5YZV_9G.js";var m={class:`alerts-container`},h={class:`alerts-content`},g={class:`alerts-header`},_={class:`alerts-actions`},v=[`disabled`],y=[`disabled`],b={key:0,class:`unread-badge`},x=[`onClick`],S={class:`alert-content`},C={class:`alert-header-row`},w={class:`alert-timestamp`},T={class:`alert-message`},E={class:`alert-details`},D={key:0,class:`unread-indicator`},O={key:1,class:`alerts-empty`},k={key:2,class:`alerts-loading`},A=s({__name:`alerts`,setup(s){let A=c(!1),j=c([]),M=c(null),N=c(`basic`);function P(){try{return JSON.parse(localStorage.getItem(`energix-user`)||`null`)}catch{return null}}let F=a(()=>j.value.filter(e=>!e.isRead).length);async function I(){A.value=!0;try{if(M.value=P(),N.value=M.value?.plan||`basic`,!M.value){j.value=[];return}j.value=(await l.getByUserId(M.value.id)).sort((e,t)=>e.isRead===t.isRead?new Date(t.timestamp)-new Date(e.timestamp):e.isRead?1:-1)}finally{A.value=!1}}function L(e){return new Intl.DateTimeFormat(`es-PE`,{dateStyle:`short`,timeStyle:`medium`}).format(new Date(e))}async function R(e){let t=j.value.find(t=>t.id===e);if(!(!t||t.isRead))try{await l.markAsRead(e),t.isRead=!0}catch(e){console.error(`markAsRead error:`,e)}}async function z(){if(!(!M.value||F.value===0))try{await l.markAllAsRead(M.value.id),j.value.forEach(e=>{e.isRead=!0})}catch(e){console.error(`markAllAsRead error:`,e)}}async function B(){if(!M.value||N.value===`basic`)return;let e=[{type:`high_consumption`,data:{percentage:85,current:255,limit:300}},{type:`new_device`,data:{deviceType:`enchufe inteligente`}},{type:`peak_hours`,data:{}},{type:`monthly_report`,data:{month:`septiembre`}}],t=e[Math.floor(Math.random()*e.length)];try{await l.generateSystemAlert(M.value.id,t.type,t.data),await I()}catch(e){console.error(`simulateAlert error:`,e)}}return t(I),(t,a)=>(r(),i(`div`,m,[o(`div`,h,[o(`div`,g,[a[2]||=o(`h2`,{class:`alerts-title`},`Alertas`,-1),o(`div`,_,[N.value===`basic`?n(``,!0):(r(),i(`button`,{key:0,class:`btn-outline`,onClick:B,disabled:A.value,title:`Simular nueva alerta`},[...a[0]||=[o(`span`,{class:`add-icon`},`+`,-1),e(` Simular alerta `,-1)]],8,v)),o(`button`,{class:`btn-outline`,onClick:z,disabled:A.value||F.value===0},[...a[1]||=[o(`span`,{class:`mark-icon`},`✓`,-1),e(` Marcar todas como leídas `,-1)]],8,y)])]),F.value>0?(r(),i(`div`,b,p(F.value)+` alerta`+p(F.value>1?`s`:``)+` sin leer `,1)):n(``,!0),o(`div`,{class:f([`alerts-list`,{loading:A.value}])},[j.value.length?(r(!0),i(u,{key:0},d(j.value,e=>(r(),i(`div`,{key:e.id,class:f([`alert-item`,[{read:e.isRead},e.type===`warning`?`alert-warning`:`alert-info`]]),tabindex:`0`,onClick:t=>R(e.id)},[o(`div`,S,[o(`div`,C,[o(`div`,{class:f([`alert-badge`,{"alert-badge-info":e.type===`info`}])},p(e.badge),3),o(`div`,w,p(L(e.timestamp)),1)]),o(`div`,T,p(e.message),1),o(`div`,E,p(e.details),1)]),e.isRead?n(``,!0):(r(),i(`div`,D))],10,x))),128)):A.value?n(``,!0):(r(),i(`div`,O,[...a[3]||=[o(`h3`,null,`No hay alertas`,-1),o(`p`,null,`Cuando tengas novedades, aparecerán aquí.`,-1)]])),A.value?(r(),i(`div`,k,[...a[4]||=[o(`div`,{class:`spinner`},null,-1),o(`p`,null,`Cargando alertas...`,-1)]])):n(``,!0)],2)])]))}},[[`__scopeId`,`data-v-87c209b5`]]);export{A as default};