import{Ct as e,Gt as t,It as n,Kt as r,Lt as i,Nt as a,Pt as o,St as s,Ut as c,Wt as l,an as u,jt as d,on as f,qt as p,un as m,zt as ee}from"./index-DTcm7Ef5.js";import{n as h,t as g}from"./chart-BWgXbyC_.js";import{n as _,t as v}from"./devices.endpoint-GbuAF8q9.js";var y={class:`content`},b={class:`main`},x={"aria-labelledby":`ov-title`},S={class:`kpi-group`},C={class:`kpi-title`},w={class:`kpi-value`},T={class:`kpi-sub`},E={class:`grid-12`},D={key:0,class:`card chart-box col-span-8`},O={key:1,class:`card chart-box col-span-4`},k={key:2,class:`card chart-box col-span-12`},A=3,j=.68,M=s({__name:`dashboard-student`,setup(s){let M=e();g.register(...h);let N={hora:null,semana:null,disp:null},P=u([]),F=u([]),I=u([]),L=u({labels:[],data:[]});async function R(){let e=await v.getByUserId(A);return P.value=e,e}function z(e){let t=e%2147483647;return t<=0&&(t+=2147483646),()=>(t=t*16807%2147483647)/2147483647}function B(e){let t=z(e*9301+49297);return Array.from({length:24},(e,n)=>{let r=.05+(n>=18&&n<=22?.2:n>=6&&n<=9?.12:.08),i=(t()-.5)*.04;return Number((r+i).toFixed(3))})}function V(e){let t=z(e.length*517);return Array.from({length:7},(e,n)=>{let r=.7+.3*Math.sin(n/7*Math.PI*2),i=(t()-.5)*.15;return Number(Math.max(.2,r+i).toFixed(2))})}function H(e){if(!e?.length)return{labels:[],data:[]};let t=e.map(e=>.5+z(e.id*101)()*2),n=t.reduce((e,t)=>e+t,0),r=t.map(e=>Number((e/n*100).toFixed(2)));return{labels:e.map(e=>e.name||`Dispositivo ${e.id}`),data:r}}function U(){N.hora?.destroy();let e=document.getElementById(`chartPorHora`);N.hora=new g(e,{type:`line`,data:{labels:Array.from({length:24},(e,t)=>`${t}:00`),datasets:[{label:`kWh`,data:F.value,borderColor:`#007bff`,backgroundColor:`rgba(0,123,255,0.15)`,fill:!0,tension:.4,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:`Consumo (kWh)`}},x:{title:{display:!0,text:`Hora del dÃ­a`}}}}})}function W(){N.disp?.destroy();let e=document.getElementById(`chartPorDispositivo`);N.disp=new g(e,{type:`bar`,data:{labels:L.value.labels,datasets:[{label:`Porcentaje de consumo`,data:L.value.data,backgroundColor:`#0b2541`}]},options:{indexAxis:`y`,responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,title:{display:!0,text:`% del total`},ticks:{font:{size:11}}},y:{ticks:{font:{size:12}}}}}})}function G(){N.semana?.destroy();let e=document.getElementById(`chartPorSemana`),t=I.value.reduce((e,t)=>e+t,0)/I.value.length;N.semana=new g(e,{data:{labels:[`Lun`,`Mar`,`MiÃ©`,`Jue`,`Vie`,`SÃ¡b`,`Dom`],datasets:[{type:`bar`,label:`Consumo diario`,data:I.value,backgroundColor:`#f46161`},{type:`line`,label:`Promedio semanal`,data:Array(7).fill(t),borderColor:`#0b2541`,borderWidth:2,pointRadius:0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:`bottom`}},scales:{y:{beginAtZero:!0,title:{display:!0,text:`Consumo (kWh)`}}}}})}let K=a(()=>P.value.length),q=a(()=>F.value.reduce((e,t)=>e+Number(t||0),0)),J=a(()=>F.value.at(-1)??0),Y=a(()=>I.value.reduce((e,t)=>e+Number(t||0),0)),X=a(()=>Y.value*j),Z=a(()=>I.value.length?Y.value/I.value.length:0),Q=a(()=>[{title:`Dispositivos activos`,value:K.value,sub:`Registrados en tu cuenta`},{title:`Consumo actual`,value:`${J.value.toFixed(2)} kWh`,sub:`MediciÃ³n en tiempo real`},{title:`Consumo de hoy`,value:`${q.value.toFixed(2)} kWh`,sub:`Total hasta el momento`},{title:`Costo semanal estimado`,value:`S/${X.value.toFixed(2)}`,sub:`Basado en tu tarifa actual`},{title:`Promedio diario`,value:`${Z.value.toFixed(2)} kWh`,sub:`Ãšltimos 7 dÃ­as`}]);async function $(){let e=await R(),t=e?.[0]?.id||1;F.value=B(t),I.value=V(e),L.value=H(e),await c(),U(),W(),G()}return t(async()=>{await $(),_(async()=>{await $()}),M.loadPersonalization()}),l(()=>Object.values(N).forEach(e=>e?.destroy())),(e,t)=>(r(),i(`div`,y,[t[4]||=ee(`<header class="topbar" data-v-9ec1a1ae><div class="greeting" data-v-9ec1a1ae><h1 data-v-9ec1a1ae>Bienvenido de vuelta, <strong data-v-9ec1a1ae>Jorge</strong>.</h1></div><div class="top-meta" data-v-9ec1a1ae><div class="datetime" data-v-9ec1a1ae><div data-v-9ec1a1ae>Jueves 25 - Set</div><div data-v-9ec1a1ae>11:00 am</div></div><button class="icon-btn" aria-label="Notificaciones" data-v-9ec1a1ae></button><div class="user" data-v-9ec1a1ae><img class="avatar" src="" alt="Foto de Jorge RamÃ­rez" data-v-9ec1a1ae><div class="user-meta" data-v-9ec1a1ae><div class="name" data-v-9ec1a1ae>Jorge RamÃ­rez</div><div class="plan" data-v-9ec1a1ae>Plan Estudiantil</div></div></div></div></header>`,1),o(`main`,b,[o(`section`,x,[t[0]||=o(`h2`,{id:`ov-title`,class:`section-title`},`Resumen general`,-1),o(`div`,S,[(r(!0),i(d,null,p(Q.value,(e,t)=>(r(),i(`article`,{class:`kpi`,key:t},[o(`h3`,C,m(e.title),1),o(`div`,w,m(e.value),1),o(`div`,T,m(e.sub),1)]))),128))])]),o(`section`,E,[f(M).chartHourly?(r(),i(`figure`,D,[...t[1]||=[o(`h3`,null,`ðŸ“ˆ Consumo de energÃ­a hoy (por hora)`,-1),o(`div`,{class:`chart-container`},[o(`canvas`,{id:`chartPorHora`})],-1)]])):n(``,!0),f(M).chartDevice?(r(),i(`figure`,O,[...t[2]||=[o(`h3`,null,`âš¡ Consumo por dispositivo`,-1),o(`div`,{class:`chart-container small`},[o(`canvas`,{id:`chartPorDispositivo`})],-1)]])):n(``,!0),f(M).chartWeekly?(r(),i(`figure`,k,[...t[3]||=[o(`h3`,null,`ðŸ“Š Consumo esta semana (diario)`,-1),o(`div`,{class:`chart-container`},[o(`canvas`,{id:`chartPorSemana`})],-1)]])):n(``,!0)])])]))}},[[`__scopeId`,`data-v-9ec1a1ae`]]);export{M as default};