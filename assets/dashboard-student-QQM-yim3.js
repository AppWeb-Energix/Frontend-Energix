import{Bt as e,Ct as t,Gt as n,It as r,Kt as i,Lt as a,Nt as o,Pt as s,St as c,Ut as l,Wt as u,an as d,jt as f,on as p,qt as m,un as h}from"./index-DmwTqtwr.js";import{n as g,r as _,t as v}from"./useAuth-36znuZB8.js";import{n as y,t as ee}from"./devices.endpoint-CRqe-zDu.js";var te={class:`content`},ne={class:`topbar`},b={class:`greeting`},x={class:`top-meta`},S={class:`user`},C={class:`user-meta`},w={class:`name`},T={class:`plan`},E={class:`main`},D={"aria-labelledby":`ov-title`},O={class:`kpi-group`},k={class:`kpi-title`},A={class:`kpi-value`},j={class:`kpi-sub`},M={class:`grid-12`},N={key:0,class:`card chart-box col-span-8`},P={key:1,class:`card chart-box col-span-4`},F={key:2,class:`card chart-box col-span-12`},I=.68,L=c({__name:`dashboard-student`,setup(c){let L=t(),{userId:R,userName:z,userPlan:re,getCurrentUser:B}=v();g.register(..._);let V={hora:null,semana:null,disp:null},H=d([]),U=d([]),W=d([]),G=d({labels:[],data:[]});async function K(){let e=await ee.getByUserId(R);return H.value=e,e}function q(e){let t=e%2147483647;return t<=0&&(t+=2147483646),()=>(t=t*16807%2147483647)/2147483647}function J(e){let t=q(e*9301+49297);return Array.from({length:24},(e,n)=>{let r=.05+(n>=18&&n<=22?.2:n>=6&&n<=9?.12:.08),i=(t()-.5)*.04;return Number((r+i).toFixed(3))})}function Y(e){let t=q(e.length*517);return Array.from({length:7},(e,n)=>{let r=.7+.3*Math.sin(n/7*Math.PI*2),i=(t()-.5)*.15;return Number(Math.max(.2,r+i).toFixed(2))})}function X(e){if(!e?.length)return{labels:[],data:[]};let t=e.map(e=>.5+q(e.id*101)()*2),n=t.reduce((e,t)=>e+t,0),r=t.map(e=>Number((e/n*100).toFixed(2)));return{labels:e.map(e=>e.name||`Dispositivo ${e.id}`),data:r}}function ie(){V.hora?.destroy();let e=document.getElementById(`chartPorHora`);V.hora=new g(e,{type:`line`,data:{labels:Array.from({length:24},(e,t)=>`${t}:00`),datasets:[{label:`kWh`,data:U.value,borderColor:`#007bff`,backgroundColor:`rgba(0,123,255,0.15)`,fill:!0,tension:.4,pointRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:`Consumo (kWh)`}},x:{title:{display:!0,text:`Hora del dÃ­a`}}}}})}function ae(){V.disp?.destroy();let e=document.getElementById(`chartPorDispositivo`);V.disp=new g(e,{type:`bar`,data:{labels:G.value.labels,datasets:[{label:`Porcentaje de consumo`,data:G.value.data,backgroundColor:`#0b2541`}]},options:{indexAxis:`y`,responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,title:{display:!0,text:`% del total`},ticks:{font:{size:11}}},y:{ticks:{font:{size:12}}}}}})}function oe(){V.semana?.destroy();let e=document.getElementById(`chartPorSemana`),t=W.value.reduce((e,t)=>e+t,0)/W.value.length;V.semana=new g(e,{data:{labels:[`Lun`,`Mar`,`MiÃ©`,`Jue`,`Vie`,`SÃ¡b`,`Dom`],datasets:[{type:`bar`,label:`Consumo diario`,data:W.value,backgroundColor:`#f46161`},{type:`line`,label:`Promedio semanal`,data:Array(7).fill(t),borderColor:`#0b2541`,borderWidth:2,pointRadius:0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:`bottom`}},scales:{y:{beginAtZero:!0,title:{display:!0,text:`Consumo (kWh)`}}}}})}let se=o(()=>H.value.length),ce=o(()=>U.value.reduce((e,t)=>e+Number(t||0),0)),Z=o(()=>U.value.at(-1)??0),Q=o(()=>W.value.reduce((e,t)=>e+Number(t||0),0)),le=o(()=>Q.value*I),ue=o(()=>W.value.length?Q.value/W.value.length:0),de=o(()=>[{title:`Dispositivos activos`,value:se.value,sub:`Registrados en tu cuenta`},{title:`Consumo actual`,value:`${Z.value.toFixed(2)} kWh`,sub:`MediciÃ³n en tiempo real`},{title:`Consumo de hoy`,value:`${ce.value.toFixed(2)} kWh`,sub:`Total hasta el momento`},{title:`Costo semanal estimado`,value:`S/${le.value.toFixed(2)}`,sub:`Basado en tu tarifa actual`},{title:`Promedio diario`,value:`${ue.value.toFixed(2)} kWh`,sub:`Ãšltimos 7 dÃ­as`}]);async function $(){let e=await K(),t=e?.[0]?.id||1;U.value=J(t),W.value=Y(e),G.value=X(e),await l(),ie(),ae(),oe()}return n(async()=>{await B(),await $(),y(async()=>{await $()}),L.loadPersonalization()}),u(()=>Object.values(V).forEach(e=>e?.destroy())),(t,n)=>(i(),a(`div`,te,[s(`header`,ne,[s(`div`,b,[s(`h1`,null,[n[0]||=e(`Bienvenido de vuelta, `,-1),s(`strong`,null,h(p(z)),1),n[1]||=e(`.`,-1)])]),s(`div`,x,[n[3]||=s(`div`,{class:`datetime`},[s(`div`,null,`Jueves 25 - Set`),s(`div`,null,`11:00 am`)],-1),n[4]||=s(`button`,{class:`icon-btn`,"aria-label":`Notificaciones`},null,-1),s(`div`,S,[n[2]||=s(`img`,{class:`avatar`,src:``,alt:`Foto de Jorge RamÃ­rez`},null,-1),s(`div`,C,[s(`div`,w,h(p(z)),1),s(`div`,T,h(p(re)),1)])])])]),s(`main`,E,[s(`section`,D,[n[5]||=s(`h2`,{id:`ov-title`,class:`section-title`},`Resumen general`,-1),s(`div`,O,[(i(!0),a(f,null,m(de.value,(e,t)=>(i(),a(`article`,{class:`kpi`,key:t},[s(`h3`,k,h(e.title),1),s(`div`,A,h(e.value),1),s(`div`,j,h(e.sub),1)]))),128))])]),s(`section`,M,[p(L).chartHourly?(i(),a(`figure`,N,[...n[6]||=[s(`h3`,null,`ðŸ“ˆ Consumo de energÃ­a hoy (por hora)`,-1),s(`div`,{class:`chart-container`},[s(`canvas`,{id:`chartPorHora`})],-1)]])):r(``,!0),p(L).chartDevice?(i(),a(`figure`,P,[...n[7]||=[s(`h3`,null,`âš¡ Consumo por dispositivo`,-1),s(`div`,{class:`chart-container small`},[s(`canvas`,{id:`chartPorDispositivo`})],-1)]])):r(``,!0),p(L).chartWeekly?(i(),a(`figure`,F,[...n[8]||=[s(`h3`,null,`ðŸ“Š Consumo esta semana (diario)`,-1),s(`div`,{class:`chart-container`},[s(`canvas`,{id:`chartPorSemana`})],-1)]])):r(``,!0)])])]))}},[[`__scopeId`,`data-v-edc80e26`]]);export{L as default};