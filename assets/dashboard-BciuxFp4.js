import{Ct as e,Gt as t,It as n,Kt as r,Lt as i,Nt as a,Pt as o,St as s,Wt as c,an as l,jt as u,on as d,qt as f,un as p,xt as m,zt as h}from"./index-DTcm7Ef5.js";import{n as g,t as _}from"./chart-BWgXbyC_.js";var ee={class:`content`},v={class:`main`},y={"aria-labelledby":`ov-title`},b={class:`kpi-group`},x={key:0,class:`kpi`},te={class:`kpi-value`},ne={class:`kpi`},re={class:`kpi-value`},ie={class:`kpi-sub`},ae={key:1,class:`kpi`},oe={class:`kpi-value`},se={key:2,class:`kpi`},S={class:`kpi-value`},C={class:`kpi`},w={class:`kpi-value`},T={class:`grid-12`},E={key:0,class:`card chart-box col-span-8`},D=[`value`],O=[`value`],k=[`value`],A=[`value`],j={key:1,class:`card chart-box col-span-4`},M=[`value`],N=[`value`],P={key:2,class:`card chart-box col-span-12`},F=[`value`],I=[`value`],L=2,R=s({__name:`dashboard`,setup(s){let R=e();t(()=>{R.loadPersonalization()}),_.register(...g);let z=l([]),B=l([]),V=l([]),H=l(null),U=l(null),W=l(null),G=l(null),K={hora:null,mes:null,dispositivo:null};async function ce(){z.value=await m.get(`/api/v1/zones?userId=${L}`)}async function q(e){return await m.get(`/api/v1/devices?zoneId=${e}`)}function J(e){let t=e%2147483647;return t<=0&&(t+=2147483646),()=>(t=t*16807%2147483647)/2147483647}function le(e){let t=J(e*9301+49297);return Array.from({length:24},(e,n)=>{let r=.05+(n>=18&&n<=22?.2:n>=6&&n<=9?.12:.08),i=(t()-.5)*.04;return Number((r+i).toFixed(3))})}function ue(e){let t=J(e*14071+7);return Array.from({length:7},(e,n)=>{let r=.9+.4*Math.sin(n/7*Math.PI*2),i=(t()-.5)*.2;return Number(Math.max(.2,r+i).toFixed(2))})}function de(e){if(!e?.length)return{labels:[],data:[]};let t=e.map(e=>.5+J(e.id*101)()*2),n=t.reduce((e,t)=>e+t,0),r=t.map(e=>Number((e/n*100).toFixed(2)));return{labels:e.map(e=>e.name||`Device ${e.id}`),data:r}}let fe=[`12 AM`,`4 AM`,`8 AM`,`12 PM`,`4 PM`,`8 PM`];function pe(e){return[e[0],e[4],e[8],e[12],e[16],e[20]]}async function Y(){if(!H.value||(B.value=await q(H.value),G.value||=B.value[0]?.id??null,!G.value))return;let e=le(G.value),t=pe(e),n=document.getElementById(`consumoPorHora`)?.getContext(`2d`);n&&(K.hora?.destroy(),K.hora=new _(n,{type:`line`,data:{labels:fe,datasets:[{label:`Consumo (kWh)`,data:t,borderColor:`#0b2541`,backgroundColor:`rgba(11,37,65,0.2)`,fill:!0,tension:.3}]},options:{responsive:!0,plugins:{legend:{display:!1}}}}))}async function X(){if(!U.value)return;let e=ue(U.value),t=document.getElementById(`consumoPorMes`)?.getContext(`2d`);t&&(K.mes?.destroy(),K.mes=new _(t,{type:`bar`,data:{labels:[`1`,`2`,`3`,`4`,`5`,`6`,`7`],datasets:[{label:`Consumo por día (kWh)`,data:e,backgroundColor:`#0b2541`}]},options:{responsive:!0,plugins:{legend:{display:!1}}}}))}async function Z(){if(!W.value)return;V.value=await q(W.value);let{labels:e,data:t}=de(V.value),n=document.getElementById(`consumoPorDispositivo`)?.getContext(`2d`);n&&(K.dispositivo?.destroy(),K.dispositivo=new _(n,{type:`doughnut`,data:{labels:e,datasets:[{data:t,backgroundColor:[`#0b2541`,`#f46161ff`,`#ffd700`,`#4caf50`]}]},options:{responsive:!0,plugins:{legend:{position:`bottom`}}}}))}async function me(e){H.value=Number(e.target.value),G.value=null,await Y()}async function he(e){G.value=Number(e.target.value),await Y()}async function ge(e){U.value=Number(e.target.value),await X()}async function _e(e){W.value=Number(e.target.value),await Z()}let Q=a(()=>(K.hora?.data?.datasets?.[0]?.data??[]).reduce((e,t)=>e+Number(t||0),0)),ve=a(()=>{let e=K.hora?.data?.datasets?.[0]?.data??[];return e[e.length-1]??0}),$=a(()=>(K.mes?.data?.datasets?.[0]?.data??[]).reduce((e,t)=>e+Number(t||0),0)),ye=a(()=>{let e=K.mes?.data?.datasets?.[0]?.data??[];return e.length?$.value/e.length:0}),be=a(()=>$.value*.7),xe=a(()=>{let e=K.hora?.data?.datasets?.[0]?.data??[];return e.length?e.reduce((e,t)=>e+Number(t||0),0)/e.length*24/4:0});return t(async()=>{await ce(),z.value.length&&(H.value=z.value[0].id,U.value=z.value[0].id,W.value=z.value[0].id),await Y(),await X(),await Z()}),c(()=>{Object.values(K).forEach(e=>e&&e.destroy())}),(e,t)=>(r(),i(`div`,ee,[t[16]||=h(`<header class="topbar" data-v-d04115c8><div class="greeting" data-v-d04115c8><h1 data-v-d04115c8>Bienvenido de vuelta, <strong data-v-d04115c8>Jorge</strong>.</h1></div><div class="top-meta" data-v-d04115c8><div class="datetime" data-v-d04115c8><div data-v-d04115c8>Jueves 25 - Set</div><div data-v-d04115c8>11:00 am</div></div><button class="icon-btn" aria-label="Notificaciones" data-v-d04115c8></button><div class="user" data-v-d04115c8><img class="avatar" src="" alt="Foto de Jorge Ramírez" data-v-d04115c8><div class="user-meta" data-v-d04115c8><div class="name" data-v-d04115c8>Jorge Ramírez</div><div class="plan" data-v-d04115c8>Plan Estudiantil</div></div></div></div></header>`,1),o(`main`,v,[o(`section`,y,[t[9]||=o(`h2`,{id:`ov-title`,class:`section-title`},`Overview`,-1),o(`div`,b,[d(R).kpiCurrent?(r(),i(`article`,x,[t[0]||=o(`h3`,{class:`kpi-title`},`Consumo actual`,-1),o(`div`,te,p(ve.value.toFixed(2))+` kWh`,1),t[1]||=o(`div`,{class:`kpi-sub`},`+10% ahorrado vs ayer`,-1)])):n(``,!0),o(`article`,ne,[t[2]||=o(`h3`,{class:`kpi-title`},`Consumo de hoy`,-1),o(`div`,re,p(Q.value.toFixed(2))+` kWh`,1),o(`div`,ie,`Hasta ahora / `+p(xe.value.toFixed(2))+` kWh proyectado`,1)]),d(R).kpiMonthly?(r(),i(`article`,ae,[t[3]||=o(`h3`,{class:`kpi-title`},`Consumo mensual`,-1),o(`div`,oe,p($.value.toFixed(0))+` kWh`,1),t[4]||=o(`div`,{class:`kpi-sub`},`-80% de una meta de 250 kWh`,-1)])):n(``,!0),d(R).kpiCost?(r(),i(`article`,se,[t[5]||=o(`h3`,{class:`kpi-title`},`Costo estimado`,-1),o(`div`,S,`S/`+p(be.value.toFixed(2)),1),t[6]||=o(`div`,{class:`kpi-sub`},`vs S/48 el mes pasado`,-1)])):n(``,!0),o(`article`,C,[t[7]||=o(`h3`,{class:`kpi-title`},`Promedio diario`,-1),o(`div`,w,p(ye.value.toFixed(1))+` kWh`,1),t[8]||=o(`div`,{class:`kpi-sub`},`Historial últimos 3 meses`,-1)])])]),o(`section`,T,[d(R).chartHourly?(r(),i(`figure`,E,[t[10]||=o(`h3`,null,`Consumo de energía hoy (por hora)`,-1),o(`select`,{value:H.value,onChange:me,style:{"margin-bottom":`1rem`}},[(r(!0),i(u,null,f(z.value,e=>(r(),i(`option`,{key:e.id,value:e.id},p(e.name),9,O))),128))],40,D),o(`select`,{value:G.value,onChange:he,style:{"margin-left":`.5rem`,"margin-bottom":`1rem`}},[(r(!0),i(u,null,f(B.value,e=>(r(),i(`option`,{key:e.id,value:e.id},p(e.name),9,A))),128))],40,k),t[11]||=o(`canvas`,{id:`consumoPorHora`},null,-1)])):n(``,!0),d(R).chartDevice?(r(),i(`figure`,j,[t[12]||=o(`h3`,null,`Consumo por dispositivo`,-1),o(`select`,{value:W.value,onChange:_e,style:{"margin-bottom":`1rem`}},[(r(!0),i(u,null,f(z.value,e=>(r(),i(`option`,{key:e.id,value:e.id},p(e.name),9,N))),128))],40,M),t[13]||=o(`canvas`,{id:`consumoPorDispositivo`},null,-1)])):n(``,!0),d(R).chartMonthly?(r(),i(`figure`,P,[t[14]||=o(`h3`,null,`Consumo este mes (diario)`,-1),o(`select`,{value:U.value,onChange:ge,style:{"margin-bottom":`1rem`}},[(r(!0),i(u,null,f(z.value,e=>(r(),i(`option`,{key:e.id,value:e.id},p(e.name),9,I))),128))],40,F),t[15]||=o(`canvas`,{id:`consumoPorMes`},null,-1)])):n(``,!0)])])]))}},[[`__scopeId`,`data-v-d04115c8`]]);export{R as default};