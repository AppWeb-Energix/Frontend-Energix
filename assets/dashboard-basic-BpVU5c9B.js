import{Ct as e,Gt as t,It as n,Kt as r,Lt as i,Pt as a,St as o,Ut as s,Wt as c,an as l,en as u,on as d,un as f}from"./index-DTcm7Ef5.js";import{n as p,t as m}from"./chart-BWgXbyC_.js";import{n as h,t as g}from"./devices.endpoint-GbuAF8q9.js";var _={class:`basic-dashboard`},v={key:0,class:`summary-cards`},y={key:0,class:`card`},b={class:`value`},x={key:1,class:`card`},S={class:`value`},C={key:2,class:`card`},w={class:`value`},T={key:1,class:`charts`},E={key:0,class:`chart`},D={key:1,class:`chart`},O={key:2,class:`empty-state`},k=8,A=o({__name:`dashboard-basic`,setup(o){m.register(...p);let A=e(),j=l(!1),M=l(0),N=l([]),P=l([]),F=l(0),I=l(0),L=l(null),R=l(null),z={consumo:null,costos:null};async function B(){let e=[];try{e=await g.getByUserId(k),console.log(`📊 Devices obtenidos:`,e)}catch(e){console.error(`❌ Error cargando dispositivos:`,e.message)}if(e=e.filter(e=>e.metrics&&Object.keys(e.metrics).length>0),j.value=e.length>0,!j.value){H();return}N.value=e.map(e=>parseFloat(e.metrics?.monthly??0)),P.value=e.map(e=>parseFloat(e.metrics?.estimatedCost??0));let t=e.map(e=>parseFloat(e.metrics?.tariff??0)).filter(e=>e>0);M.value=t.length?t.reduce((e,t)=>e+t)/t.length:0,F.value=N.value.reduce((e,t)=>e+t,0),I.value=P.value.reduce((e,t)=>e+t,0),V.value=e}let V=l([]);function H(){Object.values(z).forEach(e=>e?.destroy?.()),z={consumo:null,costos:null}}function U(e){let t=L.value,n=R.value;if(!t||!n){console.warn(`⚠️ Canvas aún no disponible (esperando render de Vue)`);return}H();let r=e.map(e=>e.name||`Dispositivo ${e.id}`);z.consumo=new m(t.getContext(`2d`),{type:`bar`,data:{labels:r,datasets:[{label:`Consumo (kWh)`,data:N.value,backgroundColor:`#0b2541`}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}}),z.costos=new m(n.getContext(`2d`),{type:`line`,data:{labels:r,datasets:[{label:`Costo (S/)`,data:P.value,borderColor:`#f46161`,backgroundColor:`rgba(244,97,97,0.2)`,fill:!0,tension:.3,pointBackgroundColor:`#f46161`,pointRadius:5}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})}let W;return t(async()=>{await B(),W=h(async()=>{console.log(`📡 Cambio detectado → recargando dashboard...`),await B()}),A.loadPersonalization()}),u(j,async e=>{e&&(await s(),U(V.value))}),c(()=>{W?.(),H()}),(e,t)=>(r(),i(`div`,_,[t[9]||=a(`h1`,{class:`title`},`Panel de Energía - Usuario Básico`,-1),j.value?(r(),i(`div`,v,[d(A).kpiCurrent?(r(),i(`div`,y,[t[0]||=a(`span`,{class:`emoji`},`💡`,-1),t[1]||=a(`p`,{class:`label`},`Consumo Total`,-1),a(`p`,b,f(F.value)+` kWh`,1)])):n(``,!0),d(A).kpiCost?(r(),i(`div`,x,[t[2]||=a(`span`,{class:`emoji`},`💰`,-1),t[3]||=a(`p`,{class:`label`},`Costo Estimado`,-1),a(`p`,S,`S/ `+f(I.value.toFixed(2)),1)])):n(``,!0),d(A).kpiTariff?(r(),i(`div`,C,[t[4]||=a(`span`,{class:`emoji`},`⚡`,-1),t[5]||=a(`p`,{class:`label`},`Tarifa Promedio`,-1),a(`p`,w,`S/ `+f(M.value.toFixed(2))+`/kWh`,1)])):n(``,!0)])):n(``,!0),j.value?(r(),i(`div`,T,[d(A).chartDevice?(r(),i(`div`,E,[t[6]||=a(`h3`,null,`Consumo por Dispositivo (kWh)`,-1),a(`canvas`,{ref_key:`consumoCanvas`,ref:L},null,512)])):n(``,!0),d(A).chartCost?(r(),i(`div`,D,[t[7]||=a(`h3`,null,`Costos Estimados por Dispositivo (S/)`,-1),a(`canvas`,{ref_key:`costosCanvas`,ref:R},null,512)])):n(``,!0)])):(r(),i(`div`,O,[...t[8]||=[a(`p`,null,`🔌 No tienes dispositivos vinculados todavía.`,-1),a(`small`,null,`Agrega un dispositivo para visualizar tus métricas.`,-1)]]))]))}},[[`__scopeId`,`data-v-07881b28`]]);export{A as default};