import{At as e,Bt as t,Dt as n,Gt as r,It as i,Kt as a,Lt as o,Ot as s,Pt as c,St as l,an as u,jt as d,nn as f,qt as p,sn as m,un as h,zt as g}from"./index-DTcm7Ef5.js";var _={class:`plans-wrap`},v={class:`options-bar`},y=[`onClick`],b={key:0,class:`plans-grid`},x={key:0,class:`btn btn-muted`,disabled:``},S={key:0,class:`btn btn-muted`,disabled:``},C={key:0,class:`btn btn-muted`,disabled:``},w={key:1,class:`plans-grid`},T={key:2,class:`plans-grid`},ee={class:`billing-wrap`},te={class:`row`},ne={class:`row two`},E={class:`chk`},D={class:`actions`},O={key:0,class:`success`},k={key:1,class:`error`},A={class:`saved-cards-wrap`},j={key:0,class:`billing-subtitle`},M={key:1,class:`saved-list`},N={class:`left`},P={class:`brand`},F={class:`meta`},I={key:0,class:`badge-default`},L={class:`right`},R=[`onClick`],z=3,B=l({__name:`subscriptions`,setup(l){let B=u(null),V=u(!0),re=u(null);r(async()=>{try{let e=await fetch(`http://localhost:3001/users/${z}`);if(!e.ok)throw Error(`Error al obtener datos del usuario`);B.value=await e.json()}catch(e){re.value=e.message}finally{V.value=!1}});async function H(e){if(B.value)try{if(!(await fetch(`http://localhost:3001/users/${B.value.id}`,{method:`PATCH`,headers:{"Content-Type":`application/json`},body:JSON.stringify({plan:e})})).ok)throw Error(`No se pudo cambiar el plan`);B.value.plan=e,alert(`Tu plan ahora es ${e.toUpperCase()}`)}catch(e){alert(`Error: `+e.message)}}let U=[`Cambiar plan`,`Renovar plan`,`Cancelar plan`],W=u(`Cambiar plan`),G=u(``),K=u(``),q=u(``),J=u(``),Y=u(!0),X=u(``),Z=u(``);function ie(e,t=4){let n=J;n.value=n.value.replace(/\D/g,``).slice(0,t)}function ae(){K.value=K.value.replace(/\D/g,``).slice(0,16).replace(/(.{4})/g,`$1 `).trim()}function oe(){let e=q.value.replace(/\D/g,``).slice(0,4);q.value=e.length>2?`${e.slice(0,2)}/${e.slice(2)}`:e}function se(e){let t=e.replace(/\s+/g,``);if(!/^\d{13,19}$/.test(t))return!1;let n=0,r=!1;for(let e=t.length-1;e>=0;e--){let i=parseInt(t[e],10);r&&(i*=2,i>9&&(i-=9)),n+=i,r=!r}return n%10==0}function Q(e){if(!/^\d{2}\/\d{2}$/.test(e))return!1;let[t,n]=e.split(`/`).map(e=>parseInt(e,10));if(t<1||t>12)return!1;let r=2e3+n,i=new Date;return new Date(r,t,0)>=new Date(i.getFullYear(),i.getMonth(),1)}function ce(){if(X.value=``,Z.value=``,!G.value.trim()){Z.value=`Ingresa el titular de la tarjeta.`;return}if(!se(K.value)){Z.value=`Número de tarjeta inválido.`;return}if(!Q(q.value)){Z.value=`Vencimiento inválido.`;return}if(!/^\d{3,4}$/.test(J.value)){Z.value=`CVV inválido.`;return}X.value=`Tarjeta guardada correctamente.`}let $=u([{id:`card_1`,brand:`Visa`,last4:`4242`,exp:`12/27`,default:!0},{id:`card_2`,brand:`Mastercard`,last4:`4444`,exp:`08/26`,default:!1}]);function le(e){if(!confirm(`¿Eliminar esta tarjeta?`))return;let t=$.value.findIndex(t=>t.id===e);t!==-1&&$.value.splice(t,1)}return(r,l)=>(a(),o(d,null,[c(`div`,_,[l[25]||=c(`h2`,{class:`title`},`Suscripciones`,-1),c(`div`,v,[(a(),o(d,null,p(U,e=>c(`button`,{key:e,class:m({active:W.value===e}),onClick:t=>W.value=e},h(e),11,y)),64))]),l[26]||=c(`p`,{class:`subtitle`},`Aumentar el límite de tus dispositivos`,-1),l[27]||=c(`p`,{class:`description`},`Elige un plan. Los límites de dispositivos e historial cambian de inmediato en la app.`,-1),W.value===`Cambiar plan`?(a(),o(`div`,b,[c(`article`,{class:m([`plan-card basic`,{"is-current":B.value?.plan===`basic`}])},[l[9]||=c(`header`,{class:`plan-head`},[c(`h3`,null,`Plan Básico`),c(`p`,{class:`meta`},`Dispositivos: 1 · Historial: 7 días`)],-1),l[10]||=c(`ul`,{class:`bullets`},[c(`li`,null,`Historial de consumo (últimos 7 días)`),c(`li`,null,`Alertas básicas (límite mensual)`),c(`li`,null,`Agrega dispositivos manualmente`)],-1),B.value?.plan===`basic`?(a(),o(`button`,x,`Plan actual`)):(a(),o(`button`,{key:1,class:`btn btn-primary`,onClick:l[0]||=e=>H(`basic`)},`Elegir Plan Básico`))],2),c(`article`,{class:m([`plan-card student`,{"is-current":B.value?.plan===`student`}])},[l[11]||=c(`header`,{class:`plan-head`},[c(`h3`,null,`Plan Estudiantil`),c(`p`,{class:`meta`},`Dispositivos: 2 · Historial: 90 días`)],-1),l[12]||=c(`ul`,{class:`bullets`},[c(`li`,null,`Todo lo del Plan Básico`),c(`li`,null,`Historial ampliado (últimos 3 meses)`),c(`li`,null,`Recomendaciones personalizadas`),c(`li`,null,`Alertas inteligentes (consumo inusual, luces encendidas)`),c(`li`,null,`Agregar maximo 2 dispositivos`)],-1),B.value?.plan===`student`?(a(),o(`button`,S,`Plan actual`)):(a(),o(`button`,{key:1,class:`btn btn-primary`,onClick:l[1]||=e=>H(`student`)},`Elegir Plan Estudiantil`))],2),c(`article`,{class:m([`plan-card family`,{"is-current":B.value?.plan===`family`}])},[l[13]||=c(`header`,{class:`plan-head`},[c(`h3`,null,`Plan Familiar (Premium)`),c(`p`,{class:`meta`},`Dispositivos: ∞ · Historial: ∞`)],-1),l[14]||=c(`ul`,{class:`bullets`},[c(`li`,null,`Todo lo del Plan Estudiantil`),c(`li`,null,`Historial completo sin límites`),c(`li`,null,`Pronóstico de consumo y ahorro estimado`),c(`li`,null,`Exportación de reportes en PDF y Excel`)],-1),B.value?.plan===`family`?(a(),o(`button`,C,`Plan actual`)):(a(),o(`button`,{key:1,class:`btn btn-primary`,onClick:l[2]||=e=>H(`family`)},`Elegir Familiar (Premium)`))],2)])):W.value===`Renovar plan`?(a(),o(`div`,w,[...l[15]||=[g(`<article class="plan-card student is-current" data-v-6ecfad30><header class="plan-head" data-v-6ecfad30><h3 data-v-6ecfad30>Plan Estudiantil</h3><p class="meta" data-v-6ecfad30>Dispositivos: 2 · Historial: 90 días</p></header><ul class="bullets" data-v-6ecfad30><li data-v-6ecfad30>Todo lo del Plan Básico</li><li data-v-6ecfad30>Historial ampliado (últimos 3 meses)</li><li data-v-6ecfad30>Recomendaciones personalizadas</li><li data-v-6ecfad30>Alertas inteligentes (consumo inusual, luces encendidas)</li></ul><button class="btn btn-primary" data-v-6ecfad30>Renovar</button></article>`,1)]])):W.value===`Cancelar plan`?(a(),o(`div`,T,[...l[16]||=[g(`<article class="plan-card student is-current" data-v-6ecfad30><header class="plan-head" data-v-6ecfad30><h3 data-v-6ecfad30>Plan Estudiantil</h3><p class="meta" data-v-6ecfad30>Dispositivos: 2 · Historial: 90 días</p></header><ul class="bullets" data-v-6ecfad30><li data-v-6ecfad30>Todo lo del Plan Básico</li><li data-v-6ecfad30>Historial ampliado (últimos 3 meses)</li><li data-v-6ecfad30>Recomendaciones personalizadas</li><li data-v-6ecfad30>Alertas inteligentes (consumo inusual, luces encendidas)</li></ul><button class="btn btn-primary" data-v-6ecfad30>Cancelar</button></article>`,1)]])):i(``,!0),l[28]||=c(`hr`,{class:`divider`},null,-1),c(`section`,ee,[l[23]||=c(`h3`,{class:`billing-title`},`Método de pago`,-1),l[24]||=c(`p`,{class:`billing-subtitle`},`Añade una tarjeta para activar y renovar tu plan.`,-1),c(`form`,{class:`card-form`,onSubmit:e(ce,[`prevent`])},[c(`div`,te,[c(`label`,null,[l[17]||=t(` Titular de la tarjeta `,-1),f(c(`input`,{"onUpdate:modelValue":l[3]||=e=>G.value=e,type:`text`,placeholder:`Nombre como aparece en la tarjeta`},null,512),[[s,G.value,void 0,{trim:!0}]])])]),c(`div`,ne,[c(`label`,null,[l[18]||=t(` Número de tarjeta `,-1),f(c(`input`,{"onUpdate:modelValue":l[4]||=e=>K.value=e,onInput:ae,inputmode:`numeric`,autocomplete:`cc-number`,placeholder:`1234 5678 9012 3456`},null,544),[[s,K.value]])]),c(`label`,null,[l[19]||=t(` Vencimiento (MM/AA) `,-1),f(c(`input`,{"onUpdate:modelValue":l[5]||=e=>q.value=e,onInput:oe,inputmode:`numeric`,autocomplete:`cc-exp`,placeholder:`MM/AA`,maxlength:`5`},null,544),[[s,q.value]])]),c(`label`,null,[l[20]||=t(` CVV `,-1),f(c(`input`,{"onUpdate:modelValue":l[6]||=e=>J.value=e,onInput:l[7]||=e=>ie(`cvv`,4),inputmode:`numeric`,autocomplete:`cc-csc`,placeholder:`3 o 4 dígitos`,maxlength:`4`},null,544),[[s,J.value]])])]),c(`label`,E,[f(c(`input`,{type:`checkbox`,"onUpdate:modelValue":l[8]||=e=>Y.value=e},null,512),[[n,Y.value]]),l[21]||=t(` Guardar como método predeterminado `,-1)]),c(`div`,D,[l[22]||=c(`button`,{class:`btn btn-primary`,type:`submit`},`Guardar tarjeta`,-1),X.value?(a(),o(`span`,O,h(X.value),1)):i(``,!0),Z.value?(a(),o(`span`,k,h(Z.value),1)):i(``,!0)])],32)])]),l[30]||=c(`hr`,{class:`divider`},null,-1),c(`section`,A,[l[29]||=c(`h3`,{class:`billing-title`},`Tarjetas guardadas`,-1),$.value.length?(a(),o(`ul`,M,[(a(!0),o(d,null,p($.value,e=>(a(),o(`li`,{key:e.id,class:`saved-item`},[c(`div`,N,[c(`div`,P,h(e.brand),1),c(`div`,F,`•••• •••• •••• `+h(e.last4)+` · `+h(e.exp),1),e.default?(a(),o(`span`,I,`Predeterminada`)):i(``,!0)]),c(`div`,L,[c(`button`,{class:`btn btn-danger`,onClick:t=>le(e.id)},`Eliminar`,8,R)])]))),128))])):(a(),o(`p`,j,`Aún no tienes tarjetas guardadas.`))])],64))}},[[`__scopeId`,`data-v-6ecfad30`]]);export{B as default};